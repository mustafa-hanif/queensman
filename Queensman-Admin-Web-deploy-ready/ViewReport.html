<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Queensman | View Inventory Report</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.7 -->
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="bower_components/Ionicons/css/ionicons.min.css">
  <!-- Theme style -->
  <!--Checkbox-->
  <link rel="stylesheet" type="text/css" href="https://flatlogic.github.io/awesome-bootstrap-checkbox/demo/build.css" />
  <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
  <!-- Morris chart -->
  <link rel="stylesheet" href="bower_components/morris.js/morris.css">
  <!-- <link rel="stylesheet" href="https://fontawesome.com/icons/ellipsis-v?style=regular"> -->
  <!-- jvectormap -->
  <link rel="stylesheet" href="bower_components/jvectormap/jquery-jvectormap.css">
  <!-- Date Picker -->
  <link rel="stylesheet" href="bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="bower_components/bootstrap-daterangepicker/daterangepicker.css">
  <!-- bootstrap wysihtml5 - text editor -->
  <link rel="stylesheet" href="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
  <!-- Google Font -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">

  <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
  <link rel="stylesheet" href="dist/css/Dev_Css.css">
  <link rel="stylesheet" href="dist/css/Inventory.css">
  <link rel="stylesheet" href="dist/css/Mobile.css">
  <link rel="icon" href="./Assets/favicon.png" type="image/x-icon">
</head>

<body style="background-color:white" class="hold-transition skin-blue sidebar-mini">

    <div id="main-content">

        <div class="row" style="margin-left:1px;">
            <div class="container">
                <div class="row" style="margin-top: 30px;">
                    <!-- <div class="col-lg-4">
                        <img src="./Assets/Queensman_logo.png" width="150" height="100" alt="">
                    </div> -->
                    <div class="col-lg-8" style="margin-top: 0px;">
                        <h3 style="font-weight: bold;"> Inventory report/ initial inspection</h2>
                    </div>
                </div>
                <div class="row" style="margin-top: 30px;">
                    <div class="col-lg-8">
                        <div class="general-info">
                            <p style="font-weight: bold;" class="villa-address"></p>
                            <p style="font-weight: bold;" class="date"></p>
                            <p style="font-weight: bold;" class="ops-team"></p>
                        </div>    
                    </div>    
                    <div class="col-lg-8">
                        <div class="render-room">
                            <!-- <p class="room-name"></p>
                            <div class="row">
                                <p class="article-type"></p>
                                <table id="report_table" class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th class="Thead">Description</th>
                                            <th class="Thead">INSPECTION</th>
                                            <th class="Thead">WORK DESCRIPTION</th>
                                            <th class="Thead">REMARKS</th>
                                        </tr>
                                    </thead>
                                    <tbody id="render_reports">
                                    </tbody>
                                </table>                  
                            </div>     -->

                        </div>
                    </div>    
                </div>
            </div>    
        </div>
        
    </div>
    <div id="editor"></div>
    <div class="row">
        <center>
            <button id="save-pdf" class="btn btn-content_bar btn-sm " type="button">Export Pdf</button>
        </center>
    </div>

 <!-- jQuery 3 -->
  <script src="bower_components/jquery/dist/jquery.min.js"></script>
  <!-- jQuery UI 1.11.4 -->
  <script src="bower_components/jquery-ui/jquery-ui.min.js"></script>
  <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
  <script>
    $.widget.bridge('uibutton', $.ui.button);
  </script>
  <!-- Bootstrap 3.3.7 -->
  <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <!-- Morris.js charts -->
  <script src="bower_components/raphael/raphael.min.js"></script>
  <script src="bower_components/morris.js/morris.min.js"></script>
  <!-- Sparkline -->
  <script src="bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script>
  <!-- jvectormap -->
  <script src="plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
  <script src="plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
  <!-- jQuery Knob Chart -->
  <script src="bower_components/jquery-knob/dist/jquery.knob.min.js"></script>
  <!-- daterangepicker -->
  <script src="bower_components/moment/min/moment.min.js"></script>
  <script src="bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>
  <!-- datepicker -->
  <script src="bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
  <!-- Bootstrap WYSIHTML5 -->
  <script src="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
  <!-- Slimscroll -->
  <script src="bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
  <!-- FastClick -->
  <script src="bower_components/fastclick/lib/fastclick.js"></script>
  <!-- AdminLTE App -->
  

    <script type="text/javascript" charset="utf8"src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.5.6/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.html5.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.print.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.27/build/pdfmake.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.27/build/vfs_fonts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>

    
	 <script src="https://kendo.cdn.telerik.com/2017.2.621/js/jquery.min.js"></script>
	 <script src="https://kendo.cdn.telerik.com/2017.2.621/js/jszip.min.js"></script>
	 <script src="https://kendo.cdn.telerik.com/2017.2.621/js/kendo.all.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.min.js"></script>
    
    <script>
        $(document).ready(function(){
            var report_id = localStorage.getItem('report_id')
            var date = localStorage.getItem('date')
            var address = localStorage.getItem('address')
            var team = localStorage.getItem('team')
            console.log(date)
            $('.date').html('Date Visit : ' + date)
            $('.ops-team').html('Unit No. : Team ' + team)
            $('.villa-address').html('Villa address : ' + address)
            var room_ids = new Array()
            var article_types = new Array()
            var articles = new Array()
            var items = {}
            var length = 0;
            var pictures = new Array();
            renderArticlesFetched(report_id)
            function renderArticlesFetched(id){
                let types = new Array();
                let ids = new Array();
                let articles = new Array();
                let rooms =new Array();
                article_types = new Array()
                let pictures = new Array()
                link = 'https://www.queensman.com/phase_2/queens_admin_Apis/fetchInventoryPicturesViaInventoryReportID.php?report_id='+report_id;
                $.get(link,function(data){
                    console.log(data)
                    $.each(data.server_response,function(index,item){
                        pictures.push(item)
                    })

                    link = 'https://www.queensman.com/phase_2/queens_admin_Apis/fetchInventoryArticlesViaInventoryReportID.php?report_id='+id
                    console.log(link)
                    $.get(link, function (data) {
                        console.log(data)
                        $.each(data.server_response, function(index,item){
                            types.push(item.rooms_and_articles.type)
                            articles.push(item)
                            rooms.push(item.rooms_and_articles.room)
                            ids.push(item.rooms_and_articles.room_id)
                        })
                        rooms = rooms.filter(function(item,index){
                            return rooms.indexOf(item) === index
                        })
                        ids = ids.filter(function(item,index){
                            return ids.indexOf(item) === index
                        })
                        console.log(rooms,ids)
                        types = types.filter(function(item,index){
                            return types.indexOf(item) === index
                        })
                        for(let i=0;i<rooms.length;i++){
                            let htmlStr=''
                            let selected_room = rooms[i]
                            console.log('selected_room',selected_room)
                            let backup = articles;
                            let selected_room_articles = backup.filter(val=>{
                                return val.rooms_and_articles.room === selected_room
                            })
                            let selected_room_types=new Array();
                            $.each(selected_room_articles,function(index,item){
                                selected_room_types.push(item.rooms_and_articles.type)
                            })
                            selected_room_types = selected_room_types.filter(function(item,index){
                                return selected_room_types.indexOf(item) === index
                            })
                            let roomObj = {
                                id      :   ids[i],
                                name    :   selected_room, 
                            }    
                            console.log(roomObj)
                            console.log(selected_room,'-> articlelength',selected_room_articles.length,'->typelength',selected_room_types.length)
                            htmlStr += '<h4 class="room-name" style="text-transform: uppercase;font-weight: bold;margin-top:20px;">'+(i+1)+'- '+rooms[i]+'</h4>'

                            for(let i=0;i<selected_room_types.length;i++){
                                console.log(selected_room_types[i])
                                let backup = selected_room_articles;
                                let result = backup.filter(val =>{
                                    return val.rooms_and_articles.type === selected_room_types[i]
                                })    
                                console.log('room-articles',result)
                                htmlStr += '<h5 class="article-type" class="room-name" style="margin-left:2%;font-weight: bold;margin-top:20px;">'+(i+1)+'- '+selected_room_types[i]+'</h5>'
                                htmlStr += '<div class="col-lg-12"><table  class="table table-bordered" style="width:100%;">'
                                htmlStr += '<thead>'
                                htmlStr += '<tr>'
                                htmlStr += '<th class="Thead">Description</th>'
                                htmlStr += '<th class="Thead">INSPECTION</th>'
                                htmlStr += '<th class="Thead">WORK DESCRIPTION</th>'
                                htmlStr += '<th class="Thead">REMARKS</th>'
                                htmlStr += '</tr>'
                                htmlStr += '</thead>'
                                htmlStr += '<tbody>'
                                $.each(result,function(index,item){
                                    htmlStr +='<tr>'
                                    if(item.rooms_and_articles.description===null||item.rooms_and_articles.description===''){
                                        htmlStr+= '<td><p>N/A</p></td>'
                                    }
                                    else{
                                        htmlStr+= '<td><p>'+item.rooms_and_articles.description+'</p></td>'
                                    }
                                    if(item.rooms_and_articles.inspection===null||item.rooms_and_articles.inspection===''){
                                        htmlStr+= '<td><p>N/A</p></td>'
                                    }else{
                                        htmlStr+= '<td><p>'+item.rooms_and_articles.inspection+'</p></td>'
                                    }
                                    if(item.rooms_and_articles.work_description===null||item.rooms_and_articles.work_description===''){
                                        htmlStr+= '<td><p>N/A</p></td>'
                                    }else{
                                        htmlStr+= '<td><p>'+item.rooms_and_articles.work_description+'</p></td>'
                                    }
                                    if(item.rooms_and_articles.remarks===null||item.rooms_and_articles.remarks===''){
                                        htmlStr+= '<td><p>N/A</p></td>'
                                    }else{
                                        htmlStr+= '<td><p>'+item.rooms_and_articles.remarks+'</p></td>'                            
                                    }
                                    htmlStr+='</tr>'
                                })
                                htmlStr += '</tbody>'
                                htmlStr += '</table>'              
                                htmlStr += '</div>'              
                                
                            }
                            htmlStr += '<div class="row"><div class="col-lg-12">'              
                            if(pictures.length>0){
                                let backup = pictures
                                console.log(selected_room)
                                const pics =  backup.filter(function(val){
                                    return val.pictures.room === selected_room
                                })
                                $.each(pics,function(index,item){
                                    console.log(item.pictures.picture_location)
                                    htmlStr+= '<div class="col-lg-3"><img src="'+item.pictures.picture_location+'" alt="" style="height: 150px"></div>'
                                })
                            }
                            $('.render-room').append(htmlStr)
                            htmlStr += '</div></div>'
                        }
                    }).fail((error) => {
                        console.log(error);
                    }); 
                }).fail((error) => {
                    console.log(error);
                }); 
            
            }

            $('#save-pdf').click(function(){
                kendo.drawing
                    .drawDOM("#main-content", 
                    { 
                        paperSize: "A4",
                        margin: { top: "1cm", bottom: "1cm" ,},
                        scale: 0.8,
                        height: 500
                    })
                        .then(function(group){
                        kendo.drawing.pdf.saveAs(group, 'InventoryReport_'+localStorage.getItem('property_id')+'.pdf')
                    });
            
            })
        })
    </script>

</body>

</html>